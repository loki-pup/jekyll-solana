---
title: 利用python建立回归模型来预测房价
teaser: 先画图看关系，再建模检验调整
category: Python
tags: [回归模型, 预测, 多元回归分析]
---

最近在做DC竞赛上面的房价预测，因为题目要求用回归分析，而数据自变量有13列，因此采用多元回归分析。
在上网搜索过资料后，决定先分别用linearRegression和Statsmodels做一下看看效果。
之后有空会补上逐步回归的试验过程。 

## 画图

先画散点图，看看数据的关系。

代码如下：
> import xlrd
>
> import matplotlib.pyplot as plt
>
> import numpy as np
>
>
> data = np.loadtxt(open(r'C:\Users\LENOVO\Desktop\kc_train.csv','r'), delimiter =",",skiprows=0)
>
> #在Python中\是转义符，\u表示其后是UNICODE编码，因此\User在这里会报错，在字符串前面加个r表示就可以了
>
>
> for i in range(3,14):
>
> plt.subplot(2,6,(i-2))                 #12个自变量，循环画子图
>
> plt.scatter(data[:,i],data[:,1])
>
> plt.title('x= %d'%i)
>
> plt.show()

效果如下：
<img src="https://raw.githubusercontent.com/loki-pup/lokiphoto/master/linear1.png" width="80%" height="80%" />

## 建立回归模型
> from sklearn.linear_model import LinearRegression
>
> from sklearn.model_selection import train_test_split
>
> from sklearn.metrics import mean_squared_error
>
>
> def linr(dtrain,dres,ztest):
>
> xtrain,xtest,ytrain,ytest = train_test_split(dtrain,dres,test_size=.3)     
>
> #把样本随机划分成训练集和测试集，test_size测试集占样本的比例
>
>
> regr=LinearRegression() 
>
> regr.fit(xtrain,ytrain)                 #利用划分好的训练集进行回归
>
> ypred = regr.predict(xtest)             #对测试数据进行预测
>
> zpred = regr.predict(ztest)
>
> MSE2 = mean_squared_error(ytest, ypred)   #题目以平武预测误差为评判标准，在此查看平均预测误差
>
> return (MSE2,zpred)
    
当然为了查看拟合效果，最直接的还是看图。
> plt.figure()
>
> plt.plot(ypred,'b',label = "predict")
>
> plt.plot(ytest,'r',label = "fact")
>
> plt.legend(loc = "upper right")
>
> plt.show()

正是通过看图，才发现了，不对数据分段，直接拟合的话，高房价的根本无法预测出来。
<img src="https://raw.githubusercontent.com/loki-pup/lokiphoto/master/linear2.png" width="80%" height="80%" />

